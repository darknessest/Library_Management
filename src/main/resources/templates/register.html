<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
    <head>
        <title>Spring Boot User Authentication</title>
        <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
        <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    
        <link rel="stylesheet" href="style_register.css">
    </head>
    <body>
        <div class="registerBox">
            <form role="form" th:action="@{/register}" th:method="post" th:object="${user}">
                
                <div class="Account">
                    <input type="text" id="username" name="username" th:field="*{username}" placeholder="请输入用户号(唯一)" onchange="onChange('username')">
                    <label class = "warning" id="error_account">&nbsp</label>
                </div>

                <div class="Nick">
                    <input type="text" id="nickname" name="nickname" th:field="*{name}" placeholder="请输入昵称" onchange="onChange('nickname')">
                    <label class = "warning" id="error_nickname">&nbsp</label>
                </div>
            
                <div class="Email">
                    <input type="text" id="email" name="email" th:field="*{email}" placeholder="请输入电子邮箱" onchange="onChange('email')">
                    <label class = "warning" id="error_email">&nbsp</label>
                </div>
    
                <div class="Password">
                    <input type="password" id="password" name="password" th:field="*{password}" placeholder="请输入密码" onchange="onChange('password')">
                    <label class = "warning" id="error_pwd">&nbsp</label>
                </div>
            
                <div class="Btn">
                    <input type="button" id="button" value="提交" onclick="onSubmit()" >
                </div>
            </form>
        </div>
    </body>

    <script>
        function isAccountTrue()
        {
            var a = $("#username").val();
            var tag = true;

            //判断用户名是否合法
            var pattern_username = new RegExp("[ ]{1,}");
            if(String(a).trim()=="")
            {
                tag = false;
                document.getElementById("error_account").innerHTML = "输入不应为空";
            }
            else if(String(a).length > 20)
            {
                tag = false;
                $("#username").select();
                document.getElementById("error_account").innerHTML = ("账户名不能超过20个字符");
            }
            else if(pattern_username.test(String(a))) //合法性检测
            {
                tag = false;
                $("#username").select();
                document.getElementById("error_account").innerHTML = ("账户名不能包含空格");
            }
            else
            {
                document.getElementById("error_account").innerHTML = "账户名输入正确";
            }
            return tag;
        }

        function isNicknameTrue()
        {
            var n = $("#nickname").val();
            var tag = 0;

             //判断用户昵称是否合法
             if(String(n).trim()=="")
            {
                tag = false;
                document.getElementById("error_nickname").innerHTML = "输入不应为空";
            }
            else if(String(n).length > 30)
            {
                tag = false;
                $("#username").select();
                document.getElementById("error_nickname").innerHTML = ("昵称不能超过30个字符");
            }
            else
            {
                document.getElementById("error_nickname").innerHTML = "昵称输入正确";
            }
            return tag;
        }

        function isPasswordTrue()
        {
            var p = $("#password").val();
            var tag = true;

               //判断密码是否合法:至少8位,最大20位,至少需要同时使用数字,字母
               var patter_pwd = new RegExp("(?=.*[0-9].*)(?=.*[a-z].*).{6,20}");
            if(String(p).trim()=="")
            {
                tag = false;
                document.getElementById("error_pwd").innerHTML = "输入不应为空";
            }
            else if(!patter_pwd.test(String(p)))
            {
                tag = false;
                $("#password").select();
                document.getElementById("error_pwd").innerHTML = "密码长度为6~20位;<br>且至少需同时使用数字和字母";
            }
            else
            {
                document.getElementById("error_pwd").innerHTML = "密码可用";
            }

            return tag;

        }

        function isEmailTrue()
        {
            var e = $("#email").val();

            var tag = true;

            
            //判断邮箱格式
            var patter_email = new RegExp("[a-zA-Z0-9]{1,}@[a-zA-Z0-9]{1,}.[a-zA-Z]{1,}(.[a-zA-Z]+)");
            if(String(e).trim()=="")
            {
                tag = false;
                document.getElementById("error_email").innerHTML = "输入不应为空";
            }
            else if(!patter_email.test(String(e)))
            {
                tag = false;
                $("#email").select();
                document.getElementById("error_email").innerHTML = "邮箱格式错误";
            }
            else
            {
                document.getElementById("error_email").innerHTML = "邮箱可用";
            }
            return tag;
        }

        function onSubmit()
        {
            var form = document.forms[0];

            var tag = isAccountTrue() && isEmailTrue() && isPasswordTrue() &&isNicknameTrue();
            
        }
    
        function onChange(myid, value)
        {
            switch(myid)
            {
                case "password": isPasswordTrue(); break;
                case "nickname":isNicknameTrue(); break;
                case "username":isAccountTrue(); break;
                case "email":isEmailTrue();break;
                default:break;
            }
        }
    </script>
</html>